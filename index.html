<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="/css/golf.css" />
    <script src="/node_modules/@babylonjs/havok/lib/umd/HavokPhysics_umd.js"></script>
    <script src="/node_modules/babylonjs/babylon.js"></script>
    <script src="/golf.js"></script>
    <title>PHYSLE Golf</title>
  </head>
  <body>
    <div id="scoreCard">Stroke 0</div>
    <div id="canvasWrapper"><canvas id="canvas"></canvas></div>
    <a href="javascript:void(0);" id="shotButton"></a>
    <script>
      var shotButton = document.getElementById('shotButton');
      var scoreCard = document.getElementById('scoreCard');
      var intervalId = 0;

      var golf = new Game();
      golf.init().then(() => {
        //console.log(golf);
        golf.addBall(0,2,100);
        golf.addGround(0,0,100,"0011");
        golf.addCorner(0,0,160,0);
        golf.addCorner(60,0,100,Math.PI);
        golf.addBarrier(30,0,130,"circle",20);
        var m = golf.addGround(60,0,160,"1100");
        golf.addHole(m);
        golf.run();
      });

      golf.addEventListener("stop", function() {
        shotButton.style.border = '3px solid #FFF';
      });

      golf.addEventListener("hole", function() {
        scoreCard.innerHTML = 'Hole in ' + golf.strokes;
      });

      // handle resize
      window.addEventListener("resize", function () {
        golf.engine.resize();
      });

      shotButton.addEventListener("mousedown", function() {
        shotButton.style.borderColor = '#FFF';
        golf.swing();
        intervalId = setInterval(() => {
          let a = golf.getImpulseAmount();
          let r = (a < 33) ? 255 - a * 3 : Math.min(255, (255 * (a / 50)));
          let g = Math.min(255, (255 * ((100 - a) / 60)));
          let b = 255 - a * 3;

          shotButton.style.borderColor = 'rgb('+r+' '+g+' '+b+')';
          
        },10);
      });

      shotButton.addEventListener("mouseout", function() {
        clearInterval(intervalId);
      })

      shotButton.addEventListener("mouseup", function() {
        clearInterval(intervalId);
        //shotButton.style.border = '3px dashed #FFF';
        shotButton.style.borderStyle = 'dashed'
        scoreCard.innerHTML = 'Stroke ' + golf.strokes;
        golf.strike();
      });
    
    </script>
  </body>
</html>
